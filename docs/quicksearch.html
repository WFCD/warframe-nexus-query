<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"lib_AttachmentCreator.js.html":{"id":"lib_AttachmentCreator.js.html","title":"Source: lib/AttachmentCreator.js","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Source: lib/AttachmentCreator.js 'use strict'; /* eslint-disable class-methods-use-this, no-param-reassign */ const n = require('numeral'); const NexusComponent = require('./nexus/base/Component'); // eslint-disable-line no-unused-vars const MarketComponent = require('./market/v1/summary'); // eslint-disable-line no-unused-vars const numerFmt = '0,0'; const wfcdLogo = 'https://warframestat.us/wfcd_logo_color.png'; const noResultAttachment = { type: 'rich', description: 'No result', color: 0xff55ff, url: 'https://warframe.market', footer: { text: 'Price data provided by NexusHub.co &amp; Warframe.Market', icon_url: wfcdLogo, }, }; const baseAttachment = { type: 'rich', title: '', color: 0xff00ff, url: '', fields: [], thumbnail: { url: '' }, footer: { icon_url: wfcdLogo, text: 'Data by NexusHub.co &amp; Warframe.Market', }, }; /** * Calculate the safe value for a provided value * @param {string} value provided value * @returns {string} safe value */ function safeValue(value) { return value ? `${Number.parseInt(value, 10)}p` : 'No Data'; } /** * Calculate the safe value for a provided value * @param {string} value1 provided minimum value * @param {string} value2 provided maximum value * @returns {string} safe value */ function safeRange(value1, value2) { return value1 ? `${Number.parseInt(value1, 10)}p - ${Number.parseInt(value2, 10)}p` : 'No Data'; } /** * Safely truncate the percentage value to a readable length * @param {number|undefined} value percentage value * @returns {string} readable percentage value (no suffix) */ function truncPercentage(value) { return String((parseFloat(value || 0) * 100).toFixed(2)); } /** * Build a field from provided nexus &amp; market components * @param {NexusComponent} nComponent nexus component * @param {MarketComponent} mComponent market component * @param {number} mCount count of total market components * @returns {Object} built field */ function fieldValue(nComponent, mComponent, mCount) { let nMedian; let nRange; let snD; let mMedian; let mRange; if (nComponent) { // console.log(`Building nexus component.... ${nComponent.name} : ${nComponent.prices.median}`); nMedian = safeValue(nComponent.prices.median); nRange = safeRange(nComponent.prices.minimum, nComponent.prices.maximum); snD = `Supply: **${nComponent.supply.count}** units (${truncPercentage(nComponent.supply.percentage)}%) ` + `- Demand: **${nComponent.demand.count}** units (${truncPercentage(nComponent.demand.percentage)}%)\\n\\u200B`; } if (mComponent) { mMedian = safeValue(mComponent.prices.soldPrice); mRange = safeRange( mComponent.prices.minimum, mComponent.prices.maximum, ); } if (nComponent &amp;&amp; mComponent) { return { name: `${mCount.length &lt; 2 ? '_ _' : mComponent.name.replace(nComponent.title, '').trim()}${nComponent.ducats ? ` - ${nComponent.ducats} ducats` : ''}`, value: '```haskell\\n' + `${'Source'.padEnd(6, ' ')} | ${'Nexus'.padEnd(13, ' ')}| Market\\n` + `${'Median'.padEnd(6, ' ')} | ${nMedian.padEnd(13, ' ')}| ${mMedian}\\n` + `${'Range'.padEnd(6, ' ')} | ${nRange.padEnd(13, ' ')}| ${mRange}\\n\\n` + `Trade Tax: ${n(mComponent.tradingTax).format(numerFmt)}cr` + `\\`\\`\\`\\n${snD}`, inline: false, }; } if (nComponent) { return { name: `${nComponent.name.trim()}${nComponent.ducats ? ` - ${nComponent.ducats} ducats` : ''}`, value: `${'```haskell\\n' + `${'Source'.padEnd(6, ' ')} | Nexus\\n` + `${'Median'.padEnd(6, ' ')} | ${nMedian}\\n` + `${'Range'.padEnd(6, ' ')} | ${nRange}\\n` + '```\\n'}${ snD}`, inline: false, }; } return { name: mComponent.name.trim(), value: '```haskell\\n' + `${'Value'.padEnd(6, ' ')} | Market\\n` + `${'Median'.padEnd(6, ' ')} | ${mMedian}\\n` + `${'Range'.padEnd(6, ' ')} | ${mRange}\\n` + '```\\n' + `Trade Tax: ${n(mComponent.tradingTax).format(numerFmt)}cr\\n`, inline: false, }; } /** * Cr */ class AttachmentCreator { constructor(logger = console) { this.logger = logger; } /** * Build an attachment from the provided components * @param {Array.&lt;NexusComponent|MarketComponent&gt;} components - * collected array of components with market data * @param {string} query Search query that these components match * @param {string} [platform='pc'] Platform for the request, defaults to 'pc' * @returns {Object} Discord-ready attachment describing the item */ attachmentFromComponents(components, query, platform = 'pc') { const attachment = JSON.parse(JSON.stringify(baseAttachment)); const nexusComponents = components .filter((component) =&gt; component &amp;&amp; component.components &amp;&amp; component.components[0].type === 'nexus-v2'); const marketComponents = components .filter((component) =&gt; component &amp;&amp; component.type === 'market-v1' &amp;&amp; typeof component.prices.soldPrice !== 'undefined'); if (nexusComponents.length &gt; 0) { nexusComponents.forEach((nexusComponent) =&gt; { attachment.title = `[${platform.toUpperCase()}] ${nexusComponent.title}`; nexusComponent.components.forEach((component) =&gt; { attachment.thumbnail.url = nexusComponent.thumbnail; const marketMatch = marketComponents.find((mk) =&gt; mk.prices &amp;&amp; mk.prices.soldPrice &amp;&amp; mk.name.toLowerCase().includes(component.name.toLowerCase())); component.title = nexusComponent.title; attachment.fields.push(fieldValue(component, marketMatch, marketComponents.length)); if (marketMatch) { attachment.url = marketMatch.url; attachment.color = parseInt(marketMatch.color, 16); attachment.thumbnail.url = marketMatch.thumbnail; } else { attachment.url = nexusComponent.url; attachment.color = parseInt(nexusComponent.color, 16); attachment.fields.push(fieldValue(component, undefined, 0)); } }); }); } else if (marketComponents.length &gt; 0) { const mCLen = marketComponents.length; marketComponents .forEach((marketComponent, index) =&gt; { if (!index) { attachment.color = parseInt(marketComponent.color, 16); attachment.title = `[${platform.toUpperCase()}] ${marketComponent.name.replace(/\\sset/i, '')}`; attachment.url = marketComponent.url; attachment.thumbnail.url = marketComponent.thumbnail; } attachment.fields.push(fieldValue(undefined, marketComponent, mCLen)); }); attachment.footer = { icon_url: wfcdLogo, text: 'Price data provided by Warframe.Market', }; } else { return noResultAttachment; } if (attachment.fields.length) { return attachment; } return noResultAttachment; } } module.exports = AttachmentCreator; × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"lib_nexus_v2_component.js.html":{"id":"lib_nexus_v2_component.js.html","title":"Source: lib/nexus/v2/component.js","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Source: lib/nexus/v2/component.js 'use strict'; const BaseComponent = require('../base/Component'); /** * Represents an individual component object of an item. */ class Component extends BaseComponent { /** * Represents an individual component object of an item. * @param {json} data the component data to parse into a component * @param {Array&lt;Ojbect&gt;} items objects with data for ducats * @constructor */ constructor(data) { super(); /** * Name of the component, display value * @type {string} */ this.name = data.name.replace(/(pc|ps4|xb1|switch)/ig, '').trim(); const suppTotal = data.prices.selling.current.orders || 0; const demandTotal = data.prices.buying.current.orders || 0; const oTotal = (suppTotal + demandTotal) || 1; /** * Supply for the component * @type {number} */ this.supply = { percentage: Number(suppTotal / oTotal).toFixed(2), count: suppTotal, }; /** * Demand for the component * @type {number} */ this.demand = { percentage: Number(demandTotal / oTotal).toFixed(2), count: demandTotal, }; const { buying, selling } = this.buildStats(data); this.prices = { buying, selling, avg: (buying.avg + selling.avg) / 2, median: (buying.median + selling.median) / 2, minimum: Math.min(buying.min, selling.min), maximum: Math.max(buying.max, selling.max), }; this.ducats = data.ducats; this.type = 'nexus-v2'; } /** * Build statistics data from nexus data * @param {Object} data Wrapped object to destructure * @return {Object} destructured object */ // eslint-disable-next-line class-methods-use-this buildStats(data) { return { buying: { avg: data.prices.buying.current.avg || data.prices.buying.previous.avg || 0, median: data.prices.buying.current.median || data.prices.buying.previous.median || 0, max: data.prices.buying.current.max || data.prices.buying.previous.max || 0, min: data.prices.buying.current.min || data.prices.buying.previous.min || 0, }, selling: { avg: data.prices.selling.current.avg || data.prices.selling.previous.avg || 0, median: data.prices.selling.current.median || data.prices.selling.previous.median || 0, max: data.prices.selling.current.max || data.prices.selling.previous.max || 0, min: data.prices.selling.current.min || data.prices.selling.previous.min || 0, }, }; } } module.exports = Component; × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"lib_nexus_base_Component.js.html":{"id":"lib_nexus_base_Component.js.html","title":"Source: lib/nexus/base/Component.js","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Source: lib/nexus/base/Component.js 'use strict'; class Component { // eslint-disable-next-line class-methods-use-this median(values) { values.sort((a, b) =&gt; a - b); const half = Math.floor(values.length / 2); if (values.length % 2) { return values[half]; } return (values[half - 1] + values[half]) / 2.0; } /** * The components's string representation * @returns {string} */ toString() { return `\\u221F${this.padName(this.name)} | average: ${(this.prices.avg &amp;&amp; !Number.isNaN(this.prices.avg) ? `${String(parseFloat(this.prices.avg).toFixed(2))}p` : '0p')}`; } /** * Pad the left side of a string so that all componets * have the same string length before the pipe * @param {string} locationString the location string to pad * @returns {string} the padded location string */ padName(locationString) { let stringRet; if (locationString.length &lt; 10) { stringRet = this.padName(`${locationString} `); } else { stringRet = locationString; } return stringRet; } } module.exports = Component; × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"lib_nexus_base_Item.js.html":{"id":"lib_nexus_base_Item.js.html","title":"Source: lib/nexus/base/Item.js","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Source: lib/nexus/base/Item.js 'use strict'; class Item { /** * @param {JSON} data to construct an item from * @param {string} path for item on site * @param {Object} settings a settings object * @param {Component} Component class to construct */ constructor(data, path, settings, Component) { /** * Array of Component objects * @type {Array&lt;Component&gt;} */ this.components = []; /** * Title (name) of item * @type {string} */ this.title = data.name; /** * Type of the item, such as: * * Prime * * Mods * * Arcane * * Syndicate * @type {string} */ this.type = data.type; /** * Supply for the component * @unused on v2 * @type {Object.&lt;number&gt;} */ this.supply = data.supply; /** * Demand for the component * @unused on v2 * @type {Object.&lt;number&gt;} */ this.demand = data.demand; data.components.forEach((componentData) =&gt; { this.components.push(new Component(componentData, data.parts)); }); this.url = `${settings.urls.nexusWeb}${path}`; this.thumbnail = `${settings.urls.nexusWeb}${data.item.components[0].imgUrl}`; } } module.exports = Item; × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"lib_market_v1_MarketFetcher.js.html":{"id":"lib_market_v1_MarketFetcher.js.html","title":"Source: lib/market/v1/MarketFetcher.js","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Source: lib/market/v1/MarketFetcher.js 'use strict'; const getColors = require('get-image-colors'); const imageDownloader = require('image-downloader'); const jsonQuery = require('json-query'); const JSONCache = require('json-fetch-cache'); const fs = require('fs').promises; const fetch = require('node-fetch'); const MarketSummary = require('./summary.js'); class MarketFetcher { constructor({ logger = console, settings, marketCache }) { /** * The json cache stpromg data from warframe.market * @type {JSONCache} */ this.marketCache = marketCache || new JSONCache(settings.urls.market, settings.maxCacheLength, { logger }); this.settings = settings; this.urls = { market: process.env.MARKET_URL_OVERRIDE || 'https://api.warframe.market', marketAssets: process.env.MARKET_ASSETS_URL_OVERRIDE || 'https://warframe.market/static/assets/', marketBasePath: '/v1/items/', }; this.logger = logger; } async averagesForItem(urlName, platform = 'pc') { const reqOpts = { headers: { platform: platform.toLowerCase(), }, }; const data = await fetch(`${this.urls.market}${this.urls.marketBasePath}${urlName}/statistics`, reqOpts) .then((d) =&gt; d.json()); const deepData = data.payload.statistics_live['48hours'][0]; const summary = { soldCount: deepData ? Number.parseInt(deepData.volume, 10) : null, soldPrice: deepData ? Number.parseInt(deepData.median, 10) : null, maximum: deepData ? Number.parseInt(deepData.max_price, 10) : null, minimum: deepData ? Number.parseInt(deepData.min_price, 10) : null, }; return summary; } async resultForItem(urlName, platform = 'pc') { const reqOpts = { headers: { platform: platform.toLowerCase(), }, }; const res = await fetch(`${this.urls.market}${this.urls.marketBasePath}${urlName}`, reqOpts) .then((d) =&gt; d.json()); const data = res.payload ? await Promise.all(res.payload.item.items_in_set .map((item) =&gt; this.summaryForItem(item))) : {}; return data; } /** * Construct a summary for the market item * @param {Object} item Warframe.market Item * @returns {Object} Market summary for item */ async summaryForItem(item) { try { // set up temp folder await fs.mkdir(`${global.__basedir}/tmp`); } catch (e) { // this.logger.error(e); } const summary = new MarketSummary(item); const prices = await this.averagesForItem(item.url_name); summary.prices = prices; const options = { url: summary.thumbnail, dest: `${global.__basedir}/tmp/${summary.name}.png`, }; try { const { image } = await imageDownloader.image(options); if (image) { const colors = await getColors(image, 'image/png'); summary.color = typeof colors !== 'undefined' ? colors[0].hex().replace('#', '0x') : 0xff0000; } } catch (e) { this.logger.error(e); } finally { await fs.unlink(`${global.__basedir}/tmp/${summary.name}.png`); } return summary; } async queryMarket(query, { successfulQuery, platform = 'pc' }) { const attachments = []; try { // get market data const marketData = await this.marketCache.getDataJson(); const marketResults = jsonQuery(`items[*item_name~/${successfulQuery || query}.*/i]`, { data: marketData.payload || {}, allowRegexp: true, }).value; if (!marketResults || marketResults.length &lt; 1) { return []; } const marketComponents = await this.resultForItem(marketResults[0].url_name, platform); if (marketComponents.length &gt; 0) { attachments.push(...marketComponents); } } catch (err) { this.logger.error(err); } return attachments; } } module.exports = MarketFetcher; × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"lib_promiseTimeout.js.html":{"id":"lib_promiseTimeout.js.html","title":"Source: lib/promiseTimeout.js","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Source: lib/promiseTimeout.js 'use strict'; /** * Copied from https://italonascimento.github.io/applying-a-timeout-to-your-promises * Apply a timeout to your promise * @param {number} ms Milliseconds to time out after * @param {Promise} promise Promise to time out * @returns {Promise} Pending promise that works or rejects with an error */ module.exports = (ms, promise) =&gt; { // Create a promise that rejects in &lt;ms&gt; milliseconds const timeout = new Promise((resolve, reject) =&gt; { const id = setTimeout(() =&gt; { clearTimeout(id); reject(new Error(`Timed out in ${ms}ms.`)); }, ms); }); // Returns a race between our timeout and the passed in promise return Promise.race([ promise, timeout, ]); }; × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"lib_nexus_v2_item.js.html":{"id":"lib_nexus_v2_item.js.html","title":"Source: lib/nexus/v2/item.js","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Source: lib/nexus/v2/item.js 'use strict'; const md = require('node-md-config'); const Component = require('./component.js'); const BaseItem = require('../base/Item'); /** * Describes an item, such as a prime item, mod, arcane, or syndicate item */ class NexusItem extends BaseItem { /** * @param {JSON} data to construct an item from * @param {string} path for item on nexushub.co * @param {Object} settings a settings object */ constructor(data, path, settings) { super(data, path, settings, Component); } /** * String representation of this Item. * @returns {string} */ toString() { const componentTokens = [`${md.codeMulti}${this.title}${md.lineEnd}\\u3000\\u3000`]; this.components.forEach((component, index) =&gt; { componentTokens.push(component.toString() + (index &lt; this.components.length - 1 ? `,${md.lineEnd}\\u3000\\u3000` : '')); }); return `${componentTokens.join('\\n')}${md.blockEnd}`; } } module.exports = NexusItem; × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"index.js.html":{"id":"index.js.html","title":"Source: index.js","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Source: index.js 'use strict'; const md = require('node-md-config'); const fs = require('fs').promises; const fss = require('fs'); const path = require('path'); const promiseTimeout = require('./lib/promiseTimeout'); const Settings = require('./lib/Settings.js'); const Creator = require('./lib/AttachmentCreator.js'); const MarketFetcher = require('./lib/market/v1/MarketFetcher.js'); const NexusFetcher = require('./lib/nexus/v2/NexusFetcher'); const noResultAttachment = { type: 'rich', description: 'No result', color: '0xff55ff', url: 'https://warframe.market', footer: { text: 'Pricechecks from NexusStats and Warframe.Market', }, }; if (!global.__basedir) { global.__basedir = __dirname; } /** * Represents a queryable datastore of information derived from `https://nexus-stats.com/api` */ class PriceCheckQuerier { /** * Creates an instance representing a WarframeNexusStats data object * @constructor */ constructor({ logger = console, nexusApi = undefined, marketCache } = {}) { this.settings = new Settings(); this.logger = logger; try { this.nexusFetcher = new NexusFetcher({ settings: this.settings, nexusApi, logger }); } catch (e) { this.logger.error(`couldn't set up nexus fetcher: ${e.message}`); } try { /** * Fetch market data * @type {MarketFetcher} */ this.marketFetcher = new MarketFetcher({ logger, settings: this.settings, marketCache }); } catch (e) { this.logger.error(`couldn't set up market fetcher: ${e.message}`); } /** * Attachment creator for generating attachments * @type {Creator} */ this.creator = new Creator(); } /** * Lookup a list of results for a query * @param {string} query Query to search the nexus-stats database against * @param {string} platform Platform to query price data for. One of 'pc', 'ps4', 'xb1' * @returns {Promise&lt;Array&lt;NexusItem&gt;&gt;} a Promise of an array of Item objects */ async priceCheckQuery(query, platform = 'pc') { if (!query) { throw new Error('This funtcion requires a query to be provided'); } // eslint-disable-next-line no-param-reassign platform = this.settings.platforms[platform.toLowerCase()]; let nexusResults; let successfulQuery; let attachments = []; if (platform !== 'switch') { try { const nexusPromise = this.nexusFetcher.queryNexus(query, platform); nexusResults = await promiseTimeout(this.settings.timeouts.nexus, nexusPromise); ({ successfulQuery, attachments } = nexusResults); } catch (e) { this.logger.error(`Couldn't process ${query} on nexus-hub... time out.`); } } if (this.marketFetcher) { try { const marketPromise = this.marketFetcher.queryMarket(query, { successfulQuery, platform }); const marketResults = await promiseTimeout(this.settings.timeouts.market, marketPromise); attachments = [...attachments, ...marketResults]; } catch (e) { this.logger.error(`Couldn't process ${query} on warframe.market... time out.`); } } return attachments.length ? attachments : [noResultAttachment]; } /** * Lookup a list of results for a query * @param {string} query Query to search the nexus-stats database against * @param {Object[]} priorResults results provided from a prior search * @param {string} platform Platform to query price data for. One of 'pc', 'ps4', 'xb1' * @returns {Promise&lt;string&gt;} a Promise of a string containing the results of the query */ async priceCheckQueryString(query, priorResults, platform = 'pc') { const components = priorResults || await this.priceCheckQuery(query, platform); const tokens = []; components.slice(0, 4).forEach((component) =&gt; { tokens.push(`${md.lineEnd}${component.toString()}`); }); let componentsToReturnString = `${md.codeMulti}${tokens.join()}${md.blockEnd}`; componentsToReturnString = components.length &gt; 0 ? componentsToReturnString : this.settings.defaultString; return componentsToReturnString; } /** * Lookup a list of results for a query * @param {string} query Query to search the nexus-stats database against * @param {Object[]} priorResults results provided from a prior search * @param {string} platform Platform to query price data for. One of 'pc', 'ps4', 'xb1' * @returns {Array&lt;Object&gt;} a Promise of an array of attachment objects */ async priceCheckQueryAttachment(query, priorResults, platform = 'pc') { const components = priorResults || await this.priceCheckQuery(query, platform); const realPlatform = this.settings.lookupAlias(platform); const attachment = this.creator.attachmentFromComponents(components, query, realPlatform); return [attachment]; } /** * Stop updating caches */ async stopUpdating() { if (this.marketFetcher.marketCache) { this.marketFetcher.marketCache.stop(); } if (fss.existsSync(`${global.__basedir}/tmp`)) { const files = await fs.readdir(`${global.__basedir}/tmp`); let allSuccess = true; for (const file of files) { try { await fs.unlink(path.join(global.__basedir, 'tmp', file)); } catch (e) { allSuccess = false; this.logger.debug(`Couldn't delete ${file}`); } } if (allSuccess) { await fs.rmdir(`${global.__basedir}/tmp`); } } } } module.exports = PriceCheckQuerier; × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"lib_Settings.js.html":{"id":"lib_Settings.js.html","title":"Source: lib/Settings.js","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Source: lib/Settings.js 'use strict'; /** * Settings storage for nexus query * @type {Settings} * @property {number} maxCacheLength - maximum length to store cached data * @property {string} nexusKey - User Key for Nexus-Stats * @property {string} nexusSecret - User Secret for Nexus-Stats * @property {string} nexusHubSecret - User Secret for NexusHub * @property {string} nexusHubKey - User Key for NexusHub * @property {Object} urls - URL list for nexus stats */ class Settings { constructor() { this.maxCacheLength = process.env.NEXUSSTATS_MAX_CACHED_TIME || 60000; this.nexusKey = process.env.NEXUSSTATS_USER_KEY || undefined; this.nexusSecret = process.env.NEXUSSTATS_USER_SECRET || undefined; this.nexusHubSecret = process.env.NEXUSHUB_USER_SECRET || undefined; this.neuxsHubUser = process.env.NEXUSHUB_USER_KEY || undefined; this.urls = { nexus: process.env.NEXUSSTATS_URL_OVERRIDE || 'https://api.nexushub.co/warframe/v1/items', nexusWeb: process.env.NEXUSSTATS_WEB_OVERRIDE || 'https://nexushub.co', nexusApi: process.env.NEXUS_API_OVERRIDE || 'https://api.nexushub.co', nexusAuth: process.env.NEXUS_AUTH_OVERRIDE || 'https://auth.nexus-stats.com', market: process.env.MARKET_URL_OVERRIDE || 'https://api.warframe.market/v1/items', marketAssets: process.env.MARKET_ASSETS_URL_OVERRIDE || 'https://warframe.market/static/assets/', }; this.platforms = { pc: 'pc', ps4: 'ps4', playstation: 'ps4', xbone: 'xb1', xbox: 'xb1', xb1: 'xb1', swi: 'switch', switch: 'switch', ns: 'switch', }; this.timeouts = { nexus: process.env.NEXUS_TIMEOUT || 4000, market: process.env.MARKET_TIMEOUT || 3000, }; this.defaultString = 'Operator, there is no such item pricecheck available.'; } /** * Look up real platform for platform alias * @param {string} platformAlias Alias of platform * @returns {string} Real platform identifier */ lookupAlias(platformAlias) { return this.platforms[platformAlias.toLowerCase()]; } } module.exports = Settings; × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"lib_market_v1_summary.js.html":{"id":"lib_market_v1_summary.js.html","title":"Source: lib/market/v1/summary.js","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Source: lib/market/v1/summary.js 'use strict'; const urls = { market: process.env.MARKET_URL_OVERRIDE || 'https://api.warframe.market/v1/items', marketAssets: process.env.MARKET_ASSETS_URL_OVERRIDE || 'https://warframe.market/static/assets/', }; /** * Represents an individual component object of an item. */ class Summary { /** * Represents an individual item. * @param {json} itemData the component data to parse into a summary * @constructor */ constructor(itemData) { this.name = itemData.en.item_name.trim(); this.thumbnail = `${urls.marketAssets}${itemData.thumb}`; this.partThumb = `${urls.marketAssets}${itemData.sub_icon}`; this.tradingTax = itemData.trading_tax || 0; this.ducats = itemData.ducats || 0; this.masteryLevel = itemData.mastery_level; this.tradable = itemData.tradable; this.wikiUrl = itemData.en.wiki_link; this.codex = itemData.en.codex; this.description = itemData.en.description.replace(/&lt;\\/?p&gt;/ig, ''); this.drops = itemData.en.drop; this.url = `http://warframe.market/items/${itemData.url_name}`; this.type = 'market-v1'; } /** * The components's string representation * @param {string} opt Option, either 'codex', 'item', 'location', 'all' * @returns {string} */ toString(opt) { let value = this.name; if (opt === 'codex' || opt === 'all') { value += '```\\n' + `Codex: ${this.codex}\\n`; } if (opt === 'item' || opt === 'all') { value += `${this.pad(`Requires: ${this.masteryLevel}`, 15)}| Tax: ${this.pad(`${this.tradingTax}cr`)}\\n` + `Item is ${this.tradable ? '' : ' not '} tradable\\n` + `${this.pad(`Sold ${this.prices.soldCount} for ${this.prices.soldPrice}`, 15)}|` + `Minimum ${this.prices.minimum} | Maximum ${this.prices.maximum}\\n`; } if (opt === 'location' || opt === 'all') { value += `${this.pad(`Drops: ${this.drops.map((drop) =&gt; drop.name).join(', ')}`, 15)}\\n`; } value += `\\`\\`\\`\\n${this.wikiUrl}`; return `\\u221F${value}`; } pad(str, length = 10, character = ' ') { let stringRet; if (str.length &lt; length) { stringRet = this.pad(`${str}${character}`); } else { stringRet = str; } return stringRet; } } module.exports = Summary; × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"global.html":{"id":"global.html","title":"Global","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Global Methods fieldValue(nComponent, mComponent, mCount) Build a field from provided nexus &amp; market components Parameters: Name Type Description nComponent NexusComponent nexus component mComponent MarketComponent market component mCount number count of total market components Source: lib/AttachmentCreator.js, line 73 Returns: built field Type Object safeRange(value1, value2) Calculate the safe value for a provided value Parameters: Name Type Description value1 string provided minimum value value2 string provided maximum value Source: lib/AttachmentCreator.js, line 53 Returns: safe value Type string safeValue(value) Calculate the safe value for a provided value Parameters: Name Type Description value string provided value Source: lib/AttachmentCreator.js, line 43 Returns: safe value Type string truncPercentage(value) Safely truncate the percentage value to a readable length Parameters: Name Type Description value number | undefined percentage value Source: lib/AttachmentCreator.js, line 62 Returns: readable percentage value (no suffix) Type string × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Classes Classes AttachmentCreator Component Item NexusItem PriceCheckQuerier Settings Summary × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage warframe-nexus-query A node project for allowing simple access to the https://nexushub.co/ api. Installation npm install --save warframe-nexus-query Usage Require Module File Accessor Description parameters warframe-nexus-query index.js .priceCheckQueryString Get Query result string query, callback warframe-nexus-query index.js .priceCheckQuery Get Query result objects, has more parameters available query, callback Environment variables Variable example default NEXUSSTATS_MAX_CACHED_TIME 600000 30000 NEXUSSTATS_URL_OVERRIDE 'https://nexus-stats.com/api' https://nexus-stats.com/api Objects Item components - List of component objects id - Unique identifier for the Item object title - Title of the item type - Type of the item supplyPercent - Of the total amount of item listings for this object, this is the percent for sale demandPercent - Of the total amount of item listings for this object, this is t looking to be bought supplyAmount - Of the total amount of item listings for this object, this is the number for sale demandAmount - Of the total amount of item listings for this object, this is the number looking to be bought Component name - Name of the component avgPrice - Average platinum price rawAverage - Raw average (non-rounded) price of the component data - Array of Miscellaneous data × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"AttachmentCreator.html":{"id":"AttachmentCreator.html","title":"Class: AttachmentCreator","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Class: AttachmentCreator AttachmentCreator Cr new AttachmentCreator() Source: lib/AttachmentCreator.js, line 136 Methods attachmentFromComponents(components, query [, platform]) Build an attachment from the provided components Parameters: Name Type Argument Default Description components Array.&lt;(NexusComponent|MarketComponent)&gt; collected array of components with market data query string Search query that these components match platform string &lt;optional&gt; 'pc' Platform for the request, defaults to 'pc' Source: lib/AttachmentCreator.js, line 148 Returns: Discord-ready attachment describing the item Type Object × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"Component.html":{"id":"Component.html","title":"Class: Component","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Class: Component Component Represents an individual component object of an item. new Component(data, items) Represents an individual component object of an item. Parameters: Name Type Description data json the component data to parse into a component items Array.&lt;Ojbect&gt; objects with data for ducats Source: lib/nexus/v2/component.js, line 15 Members demand :number Demand for the component Type: number Source: lib/nexus/v2/component.js, line 42 name :string Name of the component, display value Type: string Source: lib/nexus/v2/component.js, line 22 supply :number Supply for the component Type: number Source: lib/nexus/v2/component.js, line 33 Methods buildStats(data) Build statistics data from nexus data Parameters: Name Type Description data Object Wrapped object to destructure Source: lib/nexus/v2/component.js, line 66 Returns: destructured object Type Object padName(locationString) Pad the left side of a string so that all componets have the same string length before the pipe Parameters: Name Type Description locationString string the location string to pad Source: lib/nexus/base/Component.js, line 28 Returns: the padded location string Type string toString() The components's string representation Source: lib/nexus/base/Component.js, line 18 Returns: Type string × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"Item.html":{"id":"Item.html","title":"Class: Item","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Class: Item Item new Item(data, path, settings, Component) Parameters: Name Type Description data JSON to construct an item from path string for item on site settings Object a settings object Component Component class to construct Source: lib/nexus/base/Item.js, line 10 Members components :Array.&lt;Component&gt; Array of Component objects Type: Array.&lt;Component&gt; Source: lib/nexus/base/Item.js, line 15 demand :Object.&lt;number&gt; Demand for the component Type: Object.&lt;number&gt; Source: lib/nexus/base/Item.js, line 45 supply :Object.&lt;number&gt; Supply for the component Type: Object.&lt;number&gt; Source: lib/nexus/base/Item.js, line 38 title :string Title (name) of item Type: string Source: lib/nexus/base/Item.js, line 21 type :string Type of the item, such as: * Prime * Mods * Arcane * Syndicate Type: string Source: lib/nexus/base/Item.js, line 31 × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"NexusItem.html":{"id":"NexusItem.html","title":"Class: NexusItem","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Class: NexusItem NexusItem Describes an item, such as a prime item, mod, arcane, or syndicate item new NexusItem(data, path, settings) Parameters: Name Type Description data JSON to construct an item from path string for item on nexushub.co settings Object a settings object Source: lib/nexus/v2/item.js, line 16 Methods toString() String representation of this Item. Source: lib/nexus/v2/item.js, line 24 Returns: Type string × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"PriceCheckQuerier.html":{"id":"PriceCheckQuerier.html","title":"Class: PriceCheckQuerier","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Class: PriceCheckQuerier PriceCheckQuerier Represents a queryable datastore of information derived from `https://nexus-stats.com/api` new PriceCheckQuerier() Creates an instance representing a WarframeNexusStats data object Source: index.js, line 36 Members creator :Creator Attachment creator for generating attachments Type: Creator Source: index.js, line 60 marketFetcher :MarketFetcher Fetch market data Type: MarketFetcher Source: index.js, line 51 Methods &lt;async&gt; priceCheckQuery(query, platform) Lookup a list of results for a query Parameters: Name Type Default Description query string Query to search the nexus-stats database against platform string pc Platform to query price data for. One of 'pc', 'ps4', 'xb1' Source: index.js, line 69 Returns: a Promise of an array of Item objects Type Promise.&lt;Array.&lt;NexusItem&gt;&gt; &lt;async&gt; priceCheckQueryAttachment(query, priorResults, platform) Lookup a list of results for a query Parameters: Name Type Default Description query string Query to search the nexus-stats database against priorResults Array.&lt;Object&gt; results provided from a prior search platform string pc Platform to query price data for. One of 'pc', 'ps4', 'xb1' Source: index.js, line 129 Returns: a Promise of an array of attachment objects Type Array.&lt;Object&gt; &lt;async&gt; priceCheckQueryString(query, priorResults, platform) Lookup a list of results for a query Parameters: Name Type Default Description query string Query to search the nexus-stats database against priorResults Array.&lt;Object&gt; results provided from a prior search platform string pc Platform to query price data for. One of 'pc', 'ps4', 'xb1' Source: index.js, line 109 Returns: a Promise of a string containing the results of the query Type Promise.&lt;string&gt; &lt;async&gt; stopUpdating() Stop updating caches Source: index.js, line 140 × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"Settings.html":{"id":"Settings.html","title":"Class: Settings","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Class: Settings Settings Settings storage for nexus query new Settings() Properties: Name Type Description maxCacheLength number maximum length to store cached data nexusKey string User Key for Nexus-Stats nexusSecret string User Secret for Nexus-Stats nexusHubSecret string User Secret for NexusHub nexusHubKey string User Key for NexusHub urls Object URL list for nexus stats Source: lib/Settings.js, line 14 Methods lookupAlias(platformAlias) Look up real platform for platform alias Parameters: Name Type Description platformAlias string Alias of platform Source: lib/Settings.js, line 56 Returns: Real platform identifier Type string × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "},"Summary.html":{"id":"Summary.html","title":"Class: Summary","body":" warframe-nexus-query Classes AttachmentCreatorComponentItemNexusItemPriceCheckQuerierSettingsSummary Global fieldValuesafeRangesafeValuetruncPercentage Class: Summary Summary Represents an individual component object of an item. new Summary(itemData) Represents an individual item. Parameters: Name Type Description itemData json the component data to parse into a summary Source: lib/market/v1/summary.js, line 17 Methods toString(opt) The components's string representation Parameters: Name Type Description opt string Option, either 'codex', 'item', 'location', 'all' Source: lib/market/v1/summary.js, line 39 Returns: Type string × Search results Close Documentation generated by JSDoc 3.6.3 on Monday, September 21st 2020, 15:28:40 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
