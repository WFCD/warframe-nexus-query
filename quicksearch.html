<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"AttachmentCreator.js.html":{"id":"AttachmentCreator.js.html","title":"Source: AttachmentCreator.js","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue Source: AttachmentCreator.js 'use strict'; /* eslint-disable class-methods-use-this, no-param-reassign */ const n = require('numeral'); const MarketComponent = require('./market/v1/summary'); // eslint-disable-line no-unused-vars const numerFmt = '0,0'; const wfcdLogo = 'https://warframestat.us/wfcd_logo_color.png'; const noResultAttachment = { type: 'rich', title: 'No result', color: 0xff55ff, url: 'https://warframe.market', footer: { text: 'Price data provided by NexusHub.co &amp; Warframe.Market', icon_url: wfcdLogo, }, }; const baseAttachment = { type: 'rich', title: '', color: 0xff00ff, url: '', fields: [], thumbnail: { url: '' }, footer: { icon_url: wfcdLogo, text: 'Data by NexusHub.co &amp; Warframe.Market', }, }; /** * Calculate the safe value for a provided value * @param {string} value provided value * @returns {string} safe value */ function safeValue(value) { return value ? `${Number.parseInt(value, 10)}p` : 'No Data'; } /** * Calculate the safe value for a provided value * @param {string} value1 provided minimum value * @param {string} value2 provided maximum value * @returns {string} safe value */ function safeRange(value1, value2) { return value1 ? `${Number.parseInt(value1, 10)}p - ${Number.parseInt(value2, 10)}p` : 'No Data'; } /** * Build a field from provided nexus &amp; market components * @param {MarketComponent} mComponent market component * @returns {Object} built field */ function fieldValue(mComponent) { let mMedian; let mRange; if (mComponent) { mMedian = safeValue(mComponent.prices.soldPrice); mRange = safeRange(mComponent.prices.minimum, mComponent.prices.maximum); } return { name: mComponent.name.trim(), value: '```haskell\\n' + `${'Value'.padEnd(6, ' ')} | Market\\n` + `${'Median'.padEnd(6, ' ')} | ${mMedian}\\n` + `${'Range'.padEnd(6, ' ')} | ${mRange}\\n` + '```\\n' + `Trade Tax: ${n(mComponent.tradingTax).format(numerFmt)}cr\\n`, inline: false, }; } /** * Create the attachment itself */ class AttachmentCreator { /** * Build an attachment from the provided components * @param {Array&lt;MarketComponent&gt;} components - * collected array of components with market data * @param {string} query Search query that these components match * @param {string} [platform='pc'] Platform for the request, defaults to 'pc' * @returns {Object} Discord-ready attachment describing the item */ attachmentFromComponents(components, query, platform = 'pc') { if (!components || !components.length || !Array.isArray(components)) return noResultAttachment; const attachment = { ...baseAttachment }; const marketComponents = components.filter( (component) =&gt; component &amp;&amp; component.type === 'market-v1' &amp;&amp; typeof component.prices.soldPrice !== 'undefined' ); /* istanbul ignore else */ if (marketComponents.length &gt; 0) { marketComponents.forEach((marketComponent, index) =&gt; { if (!index) { attachment.color = parseInt(marketComponent.color, 16); attachment.title = `[${platform.toUpperCase()}] ${marketComponent.name.replace(/\\sset/i, '')}`; attachment.url = marketComponent.url; attachment.thumbnail.url = marketComponent.thumbnail; } attachment.fields.push(fieldValue(marketComponent)); }); attachment.footer = { icon_url: wfcdLogo, text: 'Price data provided by Warframe.Market', }; } else { return noResultAttachment; } /* istanbul ignore else */ if (attachment.fields.length) { return attachment; } /* istanbul ignore next */ return noResultAttachment; } } module.exports = AttachmentCreator; × Search results Close "},"market_v1_MarketFetcher.js.html":{"id":"market_v1_MarketFetcher.js.html","title":"Source: market/v1/MarketFetcher.js","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue Source: market/v1/MarketFetcher.js 'use strict'; const getColors = require('get-image-colors'); const imageDownloader = require('image-downloader'); const jsonQuery = require('json-query'); const JSONCache = require('json-fetch-cache'); const fs = require('fs').promises; const fetch = require('node-fetch'); const MarketSummary = require('./summary'); /** * @typedef {Object} MappedPrice * @property {string} volume * @property {string} median * @property {string} max_price * @property {string} min_price * @property {string} datetime ts formatted date string */ class MarketFetcher { constructor({ logger = console, settings, marketCache }) { /** * The json cache stpromg data from warframe.market * @type {JSONCache} */ this.marketCache = marketCache || new JSONCache(settings.urls.market, settings.maxCacheLength, { logger }); this.settings = settings; this.urls = { market: process.env.MARKET_URL_OVERRIDE || 'https://api.warframe.market', marketAssets: process.env.MARKET_ASSETS_URL_OVERRIDE || 'https://warframe.market/static/assets/', marketBasePath: '/v1/items/', }; this.logger = logger; this.logger.info('finished setting up market fetcher'); } async averagesForItem(urlName, platform = 'pc') { const reqOpts = { headers: { platform: platform.toLowerCase(), }, }; const data = await fetch(`${this.urls.market}${this.urls.marketBasePath}${urlName}/statistics`, reqOpts).then((d) =&gt; d.json() ); /** * @type {MappedPrice[]} */ const stats = data.payload.statistics_live['48hours']; // Descending sort stats.sort((a, b) =&gt; { const tsA = new Date(a.datetime).getTime(); const tsB = new Date(b.datetime).getTime(); if (tsA === tsB) return 0; if (tsA &lt; tsB) return -1; if (tsA &gt; tsB) return 1; /* istanbul ignore next */ return 0; }); const deepData = stats[0]; return { soldCount: deepData ? Number.parseInt(deepData.volume, 10) : undefined, soldPrice: deepData ? Number.parseInt(deepData.median, 10) : undefined, maximum: deepData ? Number.parseInt(deepData.max_price, 10) : undefined, minimum: deepData ? Number.parseInt(deepData.min_price, 10) : undefined, }; } async resultForItem(urlName, platform = 'pc') { const reqOpts = { headers: { platform: platform.toLowerCase(), }, }; const res = await fetch(`${this.urls.market}${this.urls.marketBasePath}${urlName}`, reqOpts).then((d) =&gt; d.json()); return res.payload ? Promise.all(res.payload.item.items_in_set.map((item) =&gt; this.summaryForItem(item))) : {}; } /** * Construct a summary for the market item * @param {Object} item Warframe.market Item * @returns {Object} Market summary for item */ async summaryForItem(item) { try { // set up temp folder await fs.mkdir(`${global.__basedir}/tmp`); } catch (e) { // this.logger.error(e); } const summary = new MarketSummary(item); summary.prices = await this.averagesForItem(item.url_name); const options = { url: summary.thumbnail, dest: `${global.__basedir}/tmp/${summary.name}.png`, }; try { const { image } = await imageDownloader.image(options); if (image) { const colors = await getColors(image, 'image/png'); summary.color = typeof colors !== 'undefined' ? colors[0].hex().replace('#', '0x') : 0xff0000; } } catch (e) { /* istanbul ignore next */ this.logger.error(e); } finally { await fs.unlink(`${global.__basedir}/tmp/${summary.name}.png`); } return summary; } async queryMarket(query, { successfulQuery, platform = 'pc' }) { this.logger.info(`querying market for ${query} on ${platform}`); const attachments = []; try { // get market data const marketData = await this.marketCache.getDataJson(); /* istanbul ignore if */ if (!marketData) { this.logger.info('No market data!'); return []; } const marketResults = jsonQuery(`items[*item_name~/^${successfulQuery || query}.*/i]`, { data: marketData.payload || {}, allowRegexp: true, }).value; if (!marketResults || marketResults.length &lt; 1) { this.logger.info('No market results!'); return []; } const marketComponents = await this.resultForItem(marketResults[0].url_name, platform); if (marketComponents.length &gt; 0) { attachments.push(...marketComponents); } } catch (err) { /* istanbul ignore next */ this.logger.error(err); } return attachments; } } module.exports = MarketFetcher; × Search results Close "},"promiseTimeout.js.html":{"id":"promiseTimeout.js.html","title":"Source: promiseTimeout.js","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue Source: promiseTimeout.js 'use strict'; /** * Copied from https://italonascimento.github.io/applying-a-timeout-to-your-promises * Apply a timeout to your promise * @param {number} ms Milliseconds to time out after * @param {Promise} promise Promise to time out * @returns {Promise} Pending promise that works or rejects with an error */ module.exports = (ms, promise) =&gt; { // Create a promise that rejects in &lt;ms&gt; milliseconds const timeout = new Promise((resolve, reject) =&gt; { const id = setTimeout(() =&gt; { clearTimeout(id); reject(new Error(`Timed out in ${ms}ms.`)); }, ms); }); // Returns a race between our timeout and the passed in promise return Promise.race([promise, timeout]); }; × Search results Close "},"Settings.js.html":{"id":"Settings.js.html","title":"Source: Settings.js","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue Source: Settings.js 'use strict'; /** * Settings storage for nexus query * @type {Settings} * @property {number} maxCacheLength - maximum length to store cached data * @property {Object} urls - URL list for nexus stats */ class Settings { constructor() { this.urls = { market: process.env.MARKET_URL_OVERRIDE || 'https://api.warframe.market/v1/items', marketAssets: process.env.MARKET_ASSETS_URL_OVERRIDE || 'https://warframe.market/static/assets/', }; this.platforms = { pc: 'pc', ps4: 'ps4', playstation: 'ps4', xbone: 'xb1', xbox: 'xb1', xb1: 'xb1', swi: 'switch', switch: 'switch', ns: 'switch', market: { pc: 'pc', ps4: 'ps4', playstation: 'ps4', xbone: 'xbox', xbox: 'xbox', xb1: 'xbox', swi: 'switch', switch: 'switch', ns: 'switch', }, }; this.timeouts = { market: process.env.MARKET_TIMEOUT || /* istanbul ignore next */ 3000, }; this.defaultString = 'Operator, there is no such item pricecheck available.'; } /** * Look up real platform for platform alias * @param {string} platformAlias Alias of platform * @param {boolean} market Whether or not to use market-specific aliases * @returns {string} Real platform identifier */ lookupAlias(platformAlias, market = false) { return market ? this.platforms.market[platformAlias.toLowerCase()] : this.platforms[platformAlias.toLowerCase()]; } } module.exports = Settings; × Search results Close "},"market_v1_summary.js.html":{"id":"market_v1_summary.js.html","title":"Source: market/v1/summary.js","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue Source: market/v1/summary.js 'use strict'; const urls = { market: process.env.MARKET_URL_OVERRIDE || 'https://api.warframe.market/v1/items', marketAssets: process.env.MARKET_ASSETS_URL_OVERRIDE || 'https://warframe.market/static/assets/', }; /** * Represents an individual component object of an item. */ class Summary { /** * Represents an individual item. * @param {json} itemData the component data to parse into a summary * @constructor */ constructor(itemData) { this.name = itemData.en.item_name.trim(); this.thumbnail = `${urls.marketAssets}${itemData.thumb}`; this.partThumb = `${urls.marketAssets}${itemData.sub_icon}`; /* istanbul ignore next */ this.tradingTax = itemData.trading_tax || 0; this.ducats = itemData.ducats || 0; this.masteryLevel = itemData.mastery_level; this.tradable = itemData.tradable; this.wikiUrl = itemData.en.wiki_link; this.codex = itemData.en.codex; this.description = itemData.en.description.replace(/&lt;\\/?p&gt;/gi, ''); this.drops = itemData.en.drop; this.url = `http://warframe.market/items/${itemData.url_name}`; this.type = 'market-v1'; } /** * The components' string representation * @param {string} opt Option, either 'codex', 'item', 'location', 'all' * @returns {string} */ toString(opt = 'item') { let value = this.name; /* istanbul ignore if */ if (opt === 'codex' || opt === 'all') { value += `\\`\\`\\`\\nCodex: ${this.codex}\\n`; } /* istanbul ignore else */ if (opt === 'item' || /* istanbul ignore next */ opt === 'all') { value += `${this.pad(`Requires: ${this.masteryLevel}`, 15)}| Tax: ${this.pad(`${this.tradingTax}cr`)}\\n` + `Item is ${/* istanbul ignore next */ this.tradable ? '' : ' not '} tradable\\n` + `${this.pad(`Sold ${this.prices.soldCount} for ${this.prices.soldPrice}`, 15)}|` + `Minimum ${this.prices.minimum} | Maximum ${this.prices.maximum}\\n`; } /* istanbul ignore next */ if (opt === 'location' || opt === 'all') { value += `${this.pad(`Drops: ${this.drops.map((drop) =&gt; drop.name).join(', ')}`, 15)}\\n`; } value += `\\`\\`\\`\\n${this.wikiUrl}`; return `\\u221F${value}`; } pad(str, length = 10, character = ' ') { let stringRet; if (str.length &lt; length) { stringRet = this.pad(`${str}${character}`); } else { stringRet = str; } return stringRet; } } module.exports = Summary; × Search results Close "},"global.html":{"id":"global.html","title":"Global","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue Global Methods fieldValue(mComponent) Build a field from provided nexus &amp; market components Parameters: Name Type Description mComponent MarketComponent market component Source: AttachmentCreator.js, line 58 Returns: built field Type Object safeRange(value1, value2) Calculate the safe value for a provided value Parameters: Name Type Description value1 string provided minimum value value2 string provided maximum value Source: AttachmentCreator.js, line 49 Returns: safe value Type string safeValue(value) Calculate the safe value for a provided value Parameters: Name Type Description value string provided value Source: AttachmentCreator.js, line 39 Returns: safe value Type string Type Definitions MappedPrice Type: Object Properties: Name Type Description volume string median string max_price string min_price string datetime string ts formatted date string Source: market/v1/MarketFetcher.js, line 13 × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue Classes Classes AttachmentCreator Settings Summary × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue warframe-nexus-query A node project for allowing simple summary of the Warframe.Market pricing API. Installation npm install --save warframe-nexus-query Usage Require Module File Accessor Description parameters warframe-nexus-query index.js .priceCheckQueryString Get Query result string query, callback warframe-nexus-query index.js .priceCheckQuery Get Query result objects, has more parameters available query, callback Environment variables Variable example default NEXUSSTATS_MAX_CACHED_TIME 600000 30000 NEXUSSTATS_URL_OVERRIDE 'https://nexus-stats.com/api' https://nexus-stats.com/api Objects Item components - List of component objects id - Unique identifier for the Item object title - Title of the item type - Type of the item supplyPercent - Of the total amount of item listings for this object, this is the percent for sale demandPercent - Of the total amount of item listings for this object, this is t looking to be bought supplyAmount - Of the total amount of item listings for this object, this is the number for sale demandAmount - Of the total amount of item listings for this object, this is the number looking to be bought Component name - Name of the component avgPrice - Average platinum price rawAverage - Raw average (non-rounded) price of the component data - Array of Miscellaneous data × Search results Close "},"AttachmentCreator.html":{"id":"AttachmentCreator.html","title":"Class: AttachmentCreator","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue Class: AttachmentCreator AttachmentCreator Create the attachment itself new AttachmentCreator() Source: AttachmentCreator.js, line 83 Methods attachmentFromComponents(components, query [, platform]) Build an attachment from the provided components Parameters: Name Type Argument Default Description components Array.&lt;MarketComponent&gt; collected array of components with market data query string Search query that these components match platform string &lt;optional&gt; 'pc' Platform for the request, defaults to 'pc' Source: AttachmentCreator.js, line 92 Returns: Discord-ready attachment describing the item Type Object × Search results Close "},"Settings.html":{"id":"Settings.html","title":"Class: Settings","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue Class: Settings Settings Settings storage for nexus query new Settings() Properties: Name Type Description maxCacheLength number maximum length to store cached data urls Object URL list for nexus stats Source: Settings.js, line 9 Methods lookupAlias(platformAlias, market) Look up real platform for platform alias Parameters: Name Type Default Description platformAlias string Alias of platform market boolean false Whether or not to use market-specific aliases Source: Settings.js, line 52 Returns: Real platform identifier Type string × Search results Close "},"Summary.html":{"id":"Summary.html","title":"Class: Summary","body":" warframe-nexus-query Classes AttachmentCreatorSettingsSummary Global fieldValuesafeRangesafeValue Class: Summary Summary Represents an individual component object of an item. new Summary(itemData) Represents an individual item. Parameters: Name Type Description itemData json the component data to parse into a summary Source: market/v1/summary.js, line 11 Methods toString(opt) The components' string representation Parameters: Name Type Default Description opt string item Option, either 'codex', 'item', 'location', 'all' Source: market/v1/summary.js, line 39 Returns: Type string × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
